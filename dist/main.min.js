(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"./src/js/main.js":[function(require,module,exports){
'use strict';

var game, ns = {
  Boot: require('./boot'),
  Preloader: require('./preloader'),
  Menu: require('./menu'),
  Game: require('./game')
};

game = new Phaser.Game(288, 505, Phaser.AUTO, 'flappy-bird-reborn-game');
game.state.add('boot', ns.Boot);
game.state.add('preloader', ns.Preloader);
game.state.add('menu', ns.Menu);
game.state.add('game', ns.Game);

game.state.start('boot');
},{"./boot":"/home/ubuntu/workspace/src/js/boot.js","./game":"/home/ubuntu/workspace/src/js/game.js","./menu":"/home/ubuntu/workspace/src/js/menu.js","./preloader":"/home/ubuntu/workspace/src/js/preloader.js"}],"/home/ubuntu/workspace/src/js/boot.js":[function(require,module,exports){
'use strict';

function Boot() {}

Boot.prototype = {

  preload: function() {
    this.load.image('preloader', 'assets/preloader.gif');
  },

  create: function() {
    this.game.input.maxPointers = 1;

    if (this.game.device.desktop) {
      this.game.scale.pageAlignHorizontally = true;
    }
    else {
      this.game.scaleMode = Phaser.ScaleManager.SHOW_ALL;
      this.game.scale.minWidth = 480;
      this.game.scale.minHeight = 260;
      this.game.scale.maxWidth = 640;
      this.game.scale.maxHeight = 480;
      this.game.scale.forceLandscape = true;
      this.game.scale.pageAlignHorizontally = true;
      this.game.scale.setScreenSize(true);
    }
    this.game.state.start('preloader');
  }
};

module.exports = Boot;
},{}],"/home/ubuntu/workspace/src/js/game.js":[function(require,module,exports){
'use strict';
var Bird = require('./prefab/bird'),
  Ground = require('./prefab/ground'),
  PipeGroup = require('./prefab/pipeGroup'),
  Scoreboard = require('./prefab/scoreboard');

function Game() {
  this.player = null;
}

Game.prototype = {

  create: function() {
    this.score = 0;
    this.game.physics.startSystem(Phaser.Physics.ARCADE);
    this.game.physics.arcade.gravity.y = 1200;

    // add the background sprite
    this.background = this.game.add.sprite(0, 0, 'background');

    this.bird = new Bird(this.game, 100, this.game.height / 2);
    this.game.add.existing(this.bird);

    this.ground = new Ground(this.game, 0, 400, 335, 112);
    this.game.add.existing(this.ground);

    this.pipes = this.game.add.group();

    this.instructionGroup = this.game.add.group();
    this.instructionGroup.add(
      this.game.add.sprite(this.game.width / 2, 100, 'getReady'));
    this.instructionGroup.add(
      this.game.add.sprite(this.game.width / 2, 325, 'instructions'));
    this.instructionGroup.setAll('anchor.x', 0.5);
    this.instructionGroup.setAll('anchor.y', 0.5);

    this.createStateInteractions();

    this.scoreText = this.game.add.bitmapText(this.game.width / 2, 10, 'flappyfont', this.score.toString(), 24);
    this.scoreText.visible = false;

    this.scoreSound = this.game.add.audio('score');
  },
  generatePipes: function() {
    var pipeY = this.game.rnd.integerInRange(-100, 100);
    var pipeGroup = this.pipes.getFirstExists(false);
    if (!pipeGroup) {
      pipeGroup = new PipeGroup(this.game, this.pipes);
    }
    pipeGroup.reset(this.game.width + pipeGroup.width / 2, pipeY);
  },
  update: function() {
    this.game.physics.arcade.collide(this.bird, this.ground, this.deathHandler, null, this);

    this.pipes.forEach(function(pipeGroup) {
      this.checkScore(pipeGroup);
      this.game.physics.arcade.collide(this.bird, pipeGroup, this.deathHandler, null, this);
    }, this);
  },
  deathHandler: function() {
    if(!this.bird.alive) return;
    this.bird.alive = false;
    this.pipes.callAll('stop');
    this.pipeGenerator.timer.stop();
    this.bird.animations.stop(null, true);
    this.ground.stopScroll();
    this.scoreboard = new Scoreboard(this.game);
    this.game.add.existing(this.scoreboard);
    this.scoreboard.show(this.score);
  },
  checkScore: function(pipeGroup) {
    if (pipeGroup.exists && !pipeGroup.hasScored && pipeGroup.topPipe.world.x <= this.bird.world.x) {
      pipeGroup.hasScored = true;
      this.score++;
      this.scoreText.setText(this.score.toString());
      this.scoreSound.play();
    }
  },
  startGame: function() {
    this.bird.body.allowGravity = true;
    this.bird.alive = true;

    this.pipeGenerator = this.game.time.events.loop(
      Phaser.Timer.SECOND * 1.25, this.generatePipes, this);
    this.pipeGenerator.timer.start();

    this.instructionGroup.destroy();

    this.scoreText.visible = true;
  },
  createStateInteractions: function() {
    this.game.input.keyboard.addKeyCapture([Phaser.Keyboard.SPACEBAR]);

    var flapKey = this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
    flapKey.onDown.addOnce(this.startGame, this);
    flapKey.onDown.add(this.bird.flap, this.bird);

    this.game.input.onDown.addOnce(this.startGame, this);
    this.game.input.onDown.add(this.bird.flap, this.bird);

  },
  shutdown: function() {
    this.game.input.keyboard.removeKey(Phaser.Keyboard.SPACEBAR);
    this.bird.destroy();
    this.pipes.destroy();
    this.scoreboard.destroy()
  }
};


module.exports = Game;

},{"./prefab/bird":"/home/ubuntu/workspace/src/js/prefab/bird.js","./prefab/ground":"/home/ubuntu/workspace/src/js/prefab/ground.js","./prefab/pipeGroup":"/home/ubuntu/workspace/src/js/prefab/pipeGroup.js","./prefab/scoreboard":"/home/ubuntu/workspace/src/js/prefab/scoreboard.js"}],"/home/ubuntu/workspace/src/js/menu.js":[function(require,module,exports){
'use strict';

function Menu() {
}

Menu.prototype = {

  create: function () {
    this.background = this.game.add.sprite(0, 0, 'background');
    
    // add the ground sprite as a tile
    // and start scrolling in the negative x direction
    this.ground = this.game.add.tileSprite(0,400, 335, 112, 'ground');
    this.ground.autoScroll(-200, 0);
    
    /** STEP 1 **/
    //create a group to put yhe title assets in
    // so they can be manipulated as a whole
    this.titleGroup = this.game.add.group();
    
    /** STEP 2 **/
    // create the title sprite
    // and add it to the group
    this.title = this.game.add.sprite(0, 0, 'title');
    this.titleGroup.add(this.title);
    
    /** STEP 3 **/
    // create the bird sprite
    // and add it to the title group
    this.bird = this.game.add.sprite(200, 5, 'bird');
    this.titleGroup.add(this.bird);
    
    /** STEP 4 **/
    // add an animation to the bird
    // and begin the annimation
    this.bird.animations.add('flap');
    this.bird.animations.play('flap', 12, true);
    
    /** STEP 5 **/
    // set the originating location of the group
    this.titleGroup.x = 30;
    this.titleGroup.y = 100;
    
    /** STEP 6 **/
    // create an oscillating animation tween for the group
    this.game.add.tween(this.titleGroup).to({y: 115}, 350, Phaser.Easing.Linear.NONE, true, 0, 1000, true);
    
    // add our start button with a callback
    this.startButton = this.game.add.button(this.game.width/2, 300, 'startButton', this.startClick, this);
    this.startButton.anchor.setTo(0.5,0.5);
    
  },
  startClick: function () {
    // start button click handler
    // start the 'play' state
    this.game.state.start('play');
  },
  update: function () {

  }
};

module.exports = Menu;
},{}],"/home/ubuntu/workspace/src/js/prefab/bird.js":[function(require,module,exports){
'use strict';

function Bird(game, x, y, frame) {
  Phaser.Sprite.call(this, game, x, y, 'bird', frame);
  this.animations.add('flap');
  this.animations.play('flap', 12, true);

  this.alive = false;

  game.physics.arcade.enableBody(this);
  this.body.allowGravity = false;
  this.flapSound = this.game.add.audio('flap');
}
Bird.prototype = Object.create(Phaser.Sprite.prototype);
Bird.constructor = Bird;

Bird.prototype.flap = function() {
  this.flapSound.play();
  
  this.body.velocity.y = -400;

  this.game.add.tween(this).to({
    angle: -40
  }, 100).start();
};

Bird.prototype.update = function() {
  if (this.angle < 90 && this.alive) {
    this.angle += 2.5;
  }
};

module.exports = Bird;
},{}],"/home/ubuntu/workspace/src/js/prefab/ground.js":[function(require,module,exports){
'use strict';

function Ground(game, x, y, width, height) {
  Phaser.TileSprite.call(this, game, x, y, width, height, 'ground');

  this.autoScroll(-200, 0);

  game.physics.arcade.enableBody(this);
  this.body.allowGravity = false;
  this.body.immovable = true;
}

Ground.prototype = Object.create(Phaser.TileSprite.prototype)
Ground.constructor = Ground;

module.exports = Ground;

},{}],"/home/ubuntu/workspace/src/js/prefab/pipe.js":[function(require,module,exports){
'use strict';

function Pipe(game, x, y, frame) {
  Phaser.Sprite.call(this, game, x, y, 'pipe', frame);
  this.anchor.setTo(0.5, 0.5);
  game.physics.arcade.enableBody(this);

  this.body.allowGravity = false;
  this.body.immovable = true;
}

Pipe.prototype = Object.create(Phaser.Sprite.prototype);
Pipe.constructor = Pipe;

module.exports = Pipe;
},{}],"/home/ubuntu/workspace/src/js/prefab/pipeGroup.js":[function(require,module,exports){
'use strict';
var Pipe = require('./pipe');

function PipeGroup(game, parent) {
  Phaser.Group.call(this, game, parent);

  this.topPipe = new Pipe(game, 0, 0, 0);
  this.add(this.topPipe);

  this.bottomPipe = new Pipe(game, 0, 440, 1);
  this.add(this.bottomPipe);

  this.hasScored = false;

  this.setAll('body.velocity.x', -200);


}

PipeGroup.prototype = Object.create(Phaser.Group.prototype);
PipeGroup.constructor = PipeGroup;

PipeGroup.prototype.reset = function(x, y) {
  this.topPipe.reset(0, 0);
  this.bottomPipe.reset(0, 440);

  this.x = x;
  this.y = y;

  this.setAll('body.velocity.x', -200);
  this.hasScored = false;
  this.exists = true;
};

PipeGroup.prototype.checkWorldBounds = function() {
  if (!this.topPipe.inWorld) {
    this.exists = false;
  }
};

PipeGroup.prototype.update = function() {
  this.checkWorldBounds();
};

module.exports = PipeGroup;

},{"./pipe":"/home/ubuntu/workspace/src/js/prefab/pipe.js"}],"/home/ubuntu/workspace/src/js/prefab/scoreboard.js":[function(require,module,exports){
'use strict';

function Scoreboard(game) {
    var gameover;

    Phaser.Group.call(this, game);
    gameover = this.create(this.game.width / 2, 100, 'gameover');
    gameover.anchor.setTo(0.5, 0.5);

    this.scoreboard = this.create(this.game.width / 2, 200, 'scoreboard');
    this.scoreboard.anchor.setTo(0.5, 0.5);

    this.scoreText = this.game.add.bitmapText(this.scoreboard.width, 180, 'flappyfont', '', 18);
    this.add(this.scoreText);

    this.bestScoreText = this.game.add.bitmapText(this.scoreboard.width, 230, 'flappyfont', '', 18);
    this.add(this.bestScoreText);

    // add our start button with a callback
    this.startButton = this.game.add.button(this.game.width / 2, 300, 'startButton', this.startClick, this);
    this.startButton.anchor.setTo(0.5, 0.5);

    this.add(this.startButton);

    this.y = this.game.height;
    this.x = 0;

}

Scoreboard.prototype = Object.create(Phaser.Group.prototype);
Scoreboard.constructor = Scoreboard;

Scoreboard.prototype.show = function(score) {
    var medal, bestScore;

    this.scoreText.setText(score.toString());

    if (!!localStorage) {
        // Step 2
        bestScore = localStorage.getItem('bestScore');

        // Step 3
        if (!bestScore || bestScore < score) {
            bestScore = score;
            localStorage.setItem('bestScore', bestScore);
        }
    }
    else {
        // Fallback. LocalStorage isn't available
        bestScore = 'N/A';
    }

    // Step 4
    this.bestScoreText.setText(bestScore.toString());

    // Step 5 & 6
    if (score >= 10 && score < 20) {
        medal = this.game.add.sprite(-65, 7, 'medals', 1);
        medal.anchor.setTo(0.5, 0.5);
        this.scoreboard.addChild(medal);
    }
    else if (score >= 20) {
        medal = this.game.add.sprite(-65, 7, 'medals', 0);
        medal.anchor.setTo(0.5, 0.5);
        this.scoreboard.addChild(medal);
    }

    // Step 7
    if (medal) {

        var emitter = this.game.add.emitter(medal.x, medal.y, 400);
        this.scoreboard.addChild(emitter);
        emitter.width = medal.width;
        emitter.height = medal.height;

        emitter.makeParticles('particle');

        emitter.setRotation(-100, 100);
        emitter.setXSpeed(0, 0);
        emitter.setYSpeed(0, 0);
        emitter.minParticleScale = 0.25;
        emitter.maxParticleScale = 0.5;
        emitter.setAll('body.allowGravity', false);

        emitter.start(false, 1000, 1000);

    }
    this.game.add.tween(this).to({
        y: 0
    }, 1000, Phaser.Easing.Bounce.Out, true);
};

Scoreboard.prototype.startClick = function(){
    this.game.state.start('game');
};

module.exports = Scoreboard;
},{}],"/home/ubuntu/workspace/src/js/preloader.js":[function(require,module,exports){
'use strict';

function Preloader() {
  this.asset = null;
  this.ready = false;
}

Preloader.prototype = {

  preload: function () {
    this.asset = this.add.sprite(this.width/2, this.height/2, 'preloader');
    this.asset.anchor.setTo(0.5, 0.5);

    this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
    this.load.setPreloadSprite(this.asset);
    
    this.loadImages();
    
    this.load.bitmapFont('flappyfont', 'assets/fonts/flappyfont/flappyfont.png', 'assets/fonts/flappyfont/flappyfont.fnt');
    
    this.loadSpritesheets();
    
    this.loadSounds();
  },
  
  loadImages: function(){
    this.load.image('background', 'assets/background.png');
    this.load.image('ground', 'assets/ground.png');
    this.load.image('title', 'assets/title.png');
    this.load.image('startButton', 'assets/start-button.png');
    this.load.image('instructions', 'assets/instructions.png');
    this.load.image('getReady', 'assets/get-ready.png');
    this.load.image('scoreboard', 'assets/scoreboard.png');
    this.load.image('gameover', 'assets/gameover.png');
    this.load.image('particle', 'assets/particle.png');
  },
  loadSounds: function(){
    this.load.audio('score', 'assets/score.wav');
    this.load.audio('flap', 'assets/flap.wav');
    this.load.audio('pipeHit', 'assets/pipe-hit.wav');
    this.load.audio('groundHit', 'assets/ground-hit.wav');
  },
  loadSpritesheets: function(){
    this.load.spritesheet('bird', 'assets/bird.png', 34, 24, 3);
    this.load.spritesheet('pipe', 'assets/pipes.png', 54, 320, 2);
    this.load.spritesheet('medals', 'assets/medals.png', 44, 46, 2);
  },
  create: function () {
    this.asset.cropEnabled = false;
  },
  
  update: function () {
    if (!!this.ready) {
      this.game.state.start('game');
    }
  },

  onLoadComplete: function () {
    this.ready = true;
  }
};

module.exports = Preloader;
},{}]},{},["./src/js/main.js"])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvbWFpbi5qcyIsInNyYy9qcy9ib290LmpzIiwic3JjL2pzL2dhbWUuanMiLCJzcmMvanMvbWVudS5qcyIsInNyYy9qcy9wcmVmYWIvYmlyZC5qcyIsInNyYy9qcy9wcmVmYWIvZ3JvdW5kLmpzIiwic3JjL2pzL3ByZWZhYi9waXBlLmpzIiwic3JjL2pzL3ByZWZhYi9waXBlR3JvdXAuanMiLCJzcmMvanMvcHJlZmFiL3Njb3JlYm9hcmQuanMiLCJzcmMvanMvcHJlbG9hZGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9HQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIid1c2Ugc3RyaWN0JztcblxudmFyIGdhbWUsIG5zID0ge1xuICBCb290OiByZXF1aXJlKCcuL2Jvb3QnKSxcbiAgUHJlbG9hZGVyOiByZXF1aXJlKCcuL3ByZWxvYWRlcicpLFxuICBNZW51OiByZXF1aXJlKCcuL21lbnUnKSxcbiAgR2FtZTogcmVxdWlyZSgnLi9nYW1lJylcbn07XG5cbmdhbWUgPSBuZXcgUGhhc2VyLkdhbWUoMjg4LCA1MDUsIFBoYXNlci5BVVRPLCAnZmxhcHB5LWJpcmQtcmVib3JuLWdhbWUnKTtcbmdhbWUuc3RhdGUuYWRkKCdib290JywgbnMuQm9vdCk7XG5nYW1lLnN0YXRlLmFkZCgncHJlbG9hZGVyJywgbnMuUHJlbG9hZGVyKTtcbmdhbWUuc3RhdGUuYWRkKCdtZW51JywgbnMuTWVudSk7XG5nYW1lLnN0YXRlLmFkZCgnZ2FtZScsIG5zLkdhbWUpO1xuXG5nYW1lLnN0YXRlLnN0YXJ0KCdib290Jyk7IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBCb290KCkge31cblxuQm9vdC5wcm90b3R5cGUgPSB7XG5cbiAgcHJlbG9hZDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdwcmVsb2FkZXInLCAnYXNzZXRzL3ByZWxvYWRlci5naWYnKTtcbiAgfSxcblxuICBjcmVhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZ2FtZS5pbnB1dC5tYXhQb2ludGVycyA9IDE7XG5cbiAgICBpZiAodGhpcy5nYW1lLmRldmljZS5kZXNrdG9wKSB7XG4gICAgICB0aGlzLmdhbWUuc2NhbGUucGFnZUFsaWduSG9yaXpvbnRhbGx5ID0gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLmdhbWUuc2NhbGVNb2RlID0gUGhhc2VyLlNjYWxlTWFuYWdlci5TSE9XX0FMTDtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5taW5XaWR0aCA9IDQ4MDtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5taW5IZWlnaHQgPSAyNjA7XG4gICAgICB0aGlzLmdhbWUuc2NhbGUubWF4V2lkdGggPSA2NDA7XG4gICAgICB0aGlzLmdhbWUuc2NhbGUubWF4SGVpZ2h0ID0gNDgwO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLmZvcmNlTGFuZHNjYXBlID0gdHJ1ZTtcbiAgICAgIHRoaXMuZ2FtZS5zY2FsZS5wYWdlQWxpZ25Ib3Jpem9udGFsbHkgPSB0cnVlO1xuICAgICAgdGhpcy5nYW1lLnNjYWxlLnNldFNjcmVlblNpemUodHJ1ZSk7XG4gICAgfVxuICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgncHJlbG9hZGVyJyk7XG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQm9vdDsiLCIndXNlIHN0cmljdCc7XG52YXIgQmlyZCA9IHJlcXVpcmUoJy4vcHJlZmFiL2JpcmQnKSxcbiAgR3JvdW5kID0gcmVxdWlyZSgnLi9wcmVmYWIvZ3JvdW5kJyksXG4gIFBpcGVHcm91cCA9IHJlcXVpcmUoJy4vcHJlZmFiL3BpcGVHcm91cCcpLFxuICBTY29yZWJvYXJkID0gcmVxdWlyZSgnLi9wcmVmYWIvc2NvcmVib2FyZCcpO1xuXG5mdW5jdGlvbiBHYW1lKCkge1xuICB0aGlzLnBsYXllciA9IG51bGw7XG59XG5cbkdhbWUucHJvdG90eXBlID0ge1xuXG4gIGNyZWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zY29yZSA9IDA7XG4gICAgdGhpcy5nYW1lLnBoeXNpY3Muc3RhcnRTeXN0ZW0oUGhhc2VyLlBoeXNpY3MuQVJDQURFKTtcbiAgICB0aGlzLmdhbWUucGh5c2ljcy5hcmNhZGUuZ3Jhdml0eS55ID0gMTIwMDtcblxuICAgIC8vIGFkZCB0aGUgYmFja2dyb3VuZCBzcHJpdGVcbiAgICB0aGlzLmJhY2tncm91bmQgPSB0aGlzLmdhbWUuYWRkLnNwcml0ZSgwLCAwLCAnYmFja2dyb3VuZCcpO1xuXG4gICAgdGhpcy5iaXJkID0gbmV3IEJpcmQodGhpcy5nYW1lLCAxMDAsIHRoaXMuZ2FtZS5oZWlnaHQgLyAyKTtcbiAgICB0aGlzLmdhbWUuYWRkLmV4aXN0aW5nKHRoaXMuYmlyZCk7XG5cbiAgICB0aGlzLmdyb3VuZCA9IG5ldyBHcm91bmQodGhpcy5nYW1lLCAwLCA0MDAsIDMzNSwgMTEyKTtcbiAgICB0aGlzLmdhbWUuYWRkLmV4aXN0aW5nKHRoaXMuZ3JvdW5kKTtcblxuICAgIHRoaXMucGlwZXMgPSB0aGlzLmdhbWUuYWRkLmdyb3VwKCk7XG5cbiAgICB0aGlzLmluc3RydWN0aW9uR3JvdXAgPSB0aGlzLmdhbWUuYWRkLmdyb3VwKCk7XG4gICAgdGhpcy5pbnN0cnVjdGlvbkdyb3VwLmFkZChcbiAgICAgIHRoaXMuZ2FtZS5hZGQuc3ByaXRlKHRoaXMuZ2FtZS53aWR0aCAvIDIsIDEwMCwgJ2dldFJlYWR5JykpO1xuICAgIHRoaXMuaW5zdHJ1Y3Rpb25Hcm91cC5hZGQoXG4gICAgICB0aGlzLmdhbWUuYWRkLnNwcml0ZSh0aGlzLmdhbWUud2lkdGggLyAyLCAzMjUsICdpbnN0cnVjdGlvbnMnKSk7XG4gICAgdGhpcy5pbnN0cnVjdGlvbkdyb3VwLnNldEFsbCgnYW5jaG9yLngnLCAwLjUpO1xuICAgIHRoaXMuaW5zdHJ1Y3Rpb25Hcm91cC5zZXRBbGwoJ2FuY2hvci55JywgMC41KTtcblxuICAgIHRoaXMuY3JlYXRlU3RhdGVJbnRlcmFjdGlvbnMoKTtcblxuICAgIHRoaXMuc2NvcmVUZXh0ID0gdGhpcy5nYW1lLmFkZC5iaXRtYXBUZXh0KHRoaXMuZ2FtZS53aWR0aCAvIDIsIDEwLCAnZmxhcHB5Zm9udCcsIHRoaXMuc2NvcmUudG9TdHJpbmcoKSwgMjQpO1xuICAgIHRoaXMuc2NvcmVUZXh0LnZpc2libGUgPSBmYWxzZTtcblxuICAgIHRoaXMuc2NvcmVTb3VuZCA9IHRoaXMuZ2FtZS5hZGQuYXVkaW8oJ3Njb3JlJyk7XG4gIH0sXG4gIGdlbmVyYXRlUGlwZXM6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBwaXBlWSA9IHRoaXMuZ2FtZS5ybmQuaW50ZWdlckluUmFuZ2UoLTEwMCwgMTAwKTtcbiAgICB2YXIgcGlwZUdyb3VwID0gdGhpcy5waXBlcy5nZXRGaXJzdEV4aXN0cyhmYWxzZSk7XG4gICAgaWYgKCFwaXBlR3JvdXApIHtcbiAgICAgIHBpcGVHcm91cCA9IG5ldyBQaXBlR3JvdXAodGhpcy5nYW1lLCB0aGlzLnBpcGVzKTtcbiAgICB9XG4gICAgcGlwZUdyb3VwLnJlc2V0KHRoaXMuZ2FtZS53aWR0aCArIHBpcGVHcm91cC53aWR0aCAvIDIsIHBpcGVZKTtcbiAgfSxcbiAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmdhbWUucGh5c2ljcy5hcmNhZGUuY29sbGlkZSh0aGlzLmJpcmQsIHRoaXMuZ3JvdW5kLCB0aGlzLmRlYXRoSGFuZGxlciwgbnVsbCwgdGhpcyk7XG5cbiAgICB0aGlzLnBpcGVzLmZvckVhY2goZnVuY3Rpb24ocGlwZUdyb3VwKSB7XG4gICAgICB0aGlzLmNoZWNrU2NvcmUocGlwZUdyb3VwKTtcbiAgICAgIHRoaXMuZ2FtZS5waHlzaWNzLmFyY2FkZS5jb2xsaWRlKHRoaXMuYmlyZCwgcGlwZUdyb3VwLCB0aGlzLmRlYXRoSGFuZGxlciwgbnVsbCwgdGhpcyk7XG4gICAgfSwgdGhpcyk7XG4gIH0sXG4gIGRlYXRoSGFuZGxlcjogZnVuY3Rpb24oKSB7XG4gICAgaWYoIXRoaXMuYmlyZC5hbGl2ZSkgcmV0dXJuO1xuICAgIHRoaXMuYmlyZC5hbGl2ZSA9IGZhbHNlO1xuICAgIHRoaXMucGlwZXMuY2FsbEFsbCgnc3RvcCcpO1xuICAgIHRoaXMucGlwZUdlbmVyYXRvci50aW1lci5zdG9wKCk7XG4gICAgdGhpcy5iaXJkLmFuaW1hdGlvbnMuc3RvcChudWxsLCB0cnVlKTtcbiAgICB0aGlzLmdyb3VuZC5zdG9wU2Nyb2xsKCk7XG4gICAgdGhpcy5zY29yZWJvYXJkID0gbmV3IFNjb3JlYm9hcmQodGhpcy5nYW1lKTtcbiAgICB0aGlzLmdhbWUuYWRkLmV4aXN0aW5nKHRoaXMuc2NvcmVib2FyZCk7XG4gICAgdGhpcy5zY29yZWJvYXJkLnNob3codGhpcy5zY29yZSk7XG4gIH0sXG4gIGNoZWNrU2NvcmU6IGZ1bmN0aW9uKHBpcGVHcm91cCkge1xuICAgIGlmIChwaXBlR3JvdXAuZXhpc3RzICYmICFwaXBlR3JvdXAuaGFzU2NvcmVkICYmIHBpcGVHcm91cC50b3BQaXBlLndvcmxkLnggPD0gdGhpcy5iaXJkLndvcmxkLngpIHtcbiAgICAgIHBpcGVHcm91cC5oYXNTY29yZWQgPSB0cnVlO1xuICAgICAgdGhpcy5zY29yZSsrO1xuICAgICAgdGhpcy5zY29yZVRleHQuc2V0VGV4dCh0aGlzLnNjb3JlLnRvU3RyaW5nKCkpO1xuICAgICAgdGhpcy5zY29yZVNvdW5kLnBsYXkoKTtcbiAgICB9XG4gIH0sXG4gIHN0YXJ0R2FtZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5iaXJkLmJvZHkuYWxsb3dHcmF2aXR5ID0gdHJ1ZTtcbiAgICB0aGlzLmJpcmQuYWxpdmUgPSB0cnVlO1xuXG4gICAgdGhpcy5waXBlR2VuZXJhdG9yID0gdGhpcy5nYW1lLnRpbWUuZXZlbnRzLmxvb3AoXG4gICAgICBQaGFzZXIuVGltZXIuU0VDT05EICogMS4yNSwgdGhpcy5nZW5lcmF0ZVBpcGVzLCB0aGlzKTtcbiAgICB0aGlzLnBpcGVHZW5lcmF0b3IudGltZXIuc3RhcnQoKTtcblxuICAgIHRoaXMuaW5zdHJ1Y3Rpb25Hcm91cC5kZXN0cm95KCk7XG5cbiAgICB0aGlzLnNjb3JlVGV4dC52aXNpYmxlID0gdHJ1ZTtcbiAgfSxcbiAgY3JlYXRlU3RhdGVJbnRlcmFjdGlvbnM6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZ2FtZS5pbnB1dC5rZXlib2FyZC5hZGRLZXlDYXB0dXJlKFtQaGFzZXIuS2V5Ym9hcmQuU1BBQ0VCQVJdKTtcblxuICAgIHZhciBmbGFwS2V5ID0gdGhpcy5nYW1lLmlucHV0LmtleWJvYXJkLmFkZEtleShQaGFzZXIuS2V5Ym9hcmQuU1BBQ0VCQVIpO1xuICAgIGZsYXBLZXkub25Eb3duLmFkZE9uY2UodGhpcy5zdGFydEdhbWUsIHRoaXMpO1xuICAgIGZsYXBLZXkub25Eb3duLmFkZCh0aGlzLmJpcmQuZmxhcCwgdGhpcy5iaXJkKTtcblxuICAgIHRoaXMuZ2FtZS5pbnB1dC5vbkRvd24uYWRkT25jZSh0aGlzLnN0YXJ0R2FtZSwgdGhpcyk7XG4gICAgdGhpcy5nYW1lLmlucHV0Lm9uRG93bi5hZGQodGhpcy5iaXJkLmZsYXAsIHRoaXMuYmlyZCk7XG5cbiAgfSxcbiAgc2h1dGRvd246IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZ2FtZS5pbnB1dC5rZXlib2FyZC5yZW1vdmVLZXkoUGhhc2VyLktleWJvYXJkLlNQQUNFQkFSKTtcbiAgICB0aGlzLmJpcmQuZGVzdHJveSgpO1xuICAgIHRoaXMucGlwZXMuZGVzdHJveSgpO1xuICAgIHRoaXMuc2NvcmVib2FyZC5kZXN0cm95KClcbiAgfVxufTtcblxuXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWU7XG4iLCIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIE1lbnUoKSB7XG59XG5cbk1lbnUucHJvdG90eXBlID0ge1xuXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuYmFja2dyb3VuZCA9IHRoaXMuZ2FtZS5hZGQuc3ByaXRlKDAsIDAsICdiYWNrZ3JvdW5kJyk7XG4gICAgXG4gICAgLy8gYWRkIHRoZSBncm91bmQgc3ByaXRlIGFzIGEgdGlsZVxuICAgIC8vIGFuZCBzdGFydCBzY3JvbGxpbmcgaW4gdGhlIG5lZ2F0aXZlIHggZGlyZWN0aW9uXG4gICAgdGhpcy5ncm91bmQgPSB0aGlzLmdhbWUuYWRkLnRpbGVTcHJpdGUoMCw0MDAsIDMzNSwgMTEyLCAnZ3JvdW5kJyk7XG4gICAgdGhpcy5ncm91bmQuYXV0b1Njcm9sbCgtMjAwLCAwKTtcbiAgICBcbiAgICAvKiogU1RFUCAxICoqL1xuICAgIC8vY3JlYXRlIGEgZ3JvdXAgdG8gcHV0IHloZSB0aXRsZSBhc3NldHMgaW5cbiAgICAvLyBzbyB0aGV5IGNhbiBiZSBtYW5pcHVsYXRlZCBhcyBhIHdob2xlXG4gICAgdGhpcy50aXRsZUdyb3VwID0gdGhpcy5nYW1lLmFkZC5ncm91cCgpO1xuICAgIFxuICAgIC8qKiBTVEVQIDIgKiovXG4gICAgLy8gY3JlYXRlIHRoZSB0aXRsZSBzcHJpdGVcbiAgICAvLyBhbmQgYWRkIGl0IHRvIHRoZSBncm91cFxuICAgIHRoaXMudGl0bGUgPSB0aGlzLmdhbWUuYWRkLnNwcml0ZSgwLCAwLCAndGl0bGUnKTtcbiAgICB0aGlzLnRpdGxlR3JvdXAuYWRkKHRoaXMudGl0bGUpO1xuICAgIFxuICAgIC8qKiBTVEVQIDMgKiovXG4gICAgLy8gY3JlYXRlIHRoZSBiaXJkIHNwcml0ZVxuICAgIC8vIGFuZCBhZGQgaXQgdG8gdGhlIHRpdGxlIGdyb3VwXG4gICAgdGhpcy5iaXJkID0gdGhpcy5nYW1lLmFkZC5zcHJpdGUoMjAwLCA1LCAnYmlyZCcpO1xuICAgIHRoaXMudGl0bGVHcm91cC5hZGQodGhpcy5iaXJkKTtcbiAgICBcbiAgICAvKiogU1RFUCA0ICoqL1xuICAgIC8vIGFkZCBhbiBhbmltYXRpb24gdG8gdGhlIGJpcmRcbiAgICAvLyBhbmQgYmVnaW4gdGhlIGFubmltYXRpb25cbiAgICB0aGlzLmJpcmQuYW5pbWF0aW9ucy5hZGQoJ2ZsYXAnKTtcbiAgICB0aGlzLmJpcmQuYW5pbWF0aW9ucy5wbGF5KCdmbGFwJywgMTIsIHRydWUpO1xuICAgIFxuICAgIC8qKiBTVEVQIDUgKiovXG4gICAgLy8gc2V0IHRoZSBvcmlnaW5hdGluZyBsb2NhdGlvbiBvZiB0aGUgZ3JvdXBcbiAgICB0aGlzLnRpdGxlR3JvdXAueCA9IDMwO1xuICAgIHRoaXMudGl0bGVHcm91cC55ID0gMTAwO1xuICAgIFxuICAgIC8qKiBTVEVQIDYgKiovXG4gICAgLy8gY3JlYXRlIGFuIG9zY2lsbGF0aW5nIGFuaW1hdGlvbiB0d2VlbiBmb3IgdGhlIGdyb3VwXG4gICAgdGhpcy5nYW1lLmFkZC50d2Vlbih0aGlzLnRpdGxlR3JvdXApLnRvKHt5OiAxMTV9LCAzNTAsIFBoYXNlci5FYXNpbmcuTGluZWFyLk5PTkUsIHRydWUsIDAsIDEwMDAsIHRydWUpO1xuICAgIFxuICAgIC8vIGFkZCBvdXIgc3RhcnQgYnV0dG9uIHdpdGggYSBjYWxsYmFja1xuICAgIHRoaXMuc3RhcnRCdXR0b24gPSB0aGlzLmdhbWUuYWRkLmJ1dHRvbih0aGlzLmdhbWUud2lkdGgvMiwgMzAwLCAnc3RhcnRCdXR0b24nLCB0aGlzLnN0YXJ0Q2xpY2ssIHRoaXMpO1xuICAgIHRoaXMuc3RhcnRCdXR0b24uYW5jaG9yLnNldFRvKDAuNSwwLjUpO1xuICAgIFxuICB9LFxuICBzdGFydENsaWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgLy8gc3RhcnQgYnV0dG9uIGNsaWNrIGhhbmRsZXJcbiAgICAvLyBzdGFydCB0aGUgJ3BsYXknIHN0YXRlXG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdwbGF5Jyk7XG4gIH0sXG4gIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xuXG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTWVudTsiLCIndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIEJpcmQoZ2FtZSwgeCwgeSwgZnJhbWUpIHtcbiAgUGhhc2VyLlNwcml0ZS5jYWxsKHRoaXMsIGdhbWUsIHgsIHksICdiaXJkJywgZnJhbWUpO1xuICB0aGlzLmFuaW1hdGlvbnMuYWRkKCdmbGFwJyk7XG4gIHRoaXMuYW5pbWF0aW9ucy5wbGF5KCdmbGFwJywgMTIsIHRydWUpO1xuXG4gIHRoaXMuYWxpdmUgPSBmYWxzZTtcblxuICBnYW1lLnBoeXNpY3MuYXJjYWRlLmVuYWJsZUJvZHkodGhpcyk7XG4gIHRoaXMuYm9keS5hbGxvd0dyYXZpdHkgPSBmYWxzZTtcbiAgdGhpcy5mbGFwU291bmQgPSB0aGlzLmdhbWUuYWRkLmF1ZGlvKCdmbGFwJyk7XG59XG5CaXJkLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoUGhhc2VyLlNwcml0ZS5wcm90b3R5cGUpO1xuQmlyZC5jb25zdHJ1Y3RvciA9IEJpcmQ7XG5cbkJpcmQucHJvdG90eXBlLmZsYXAgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5mbGFwU291bmQucGxheSgpO1xuICBcbiAgdGhpcy5ib2R5LnZlbG9jaXR5LnkgPSAtNDAwO1xuXG4gIHRoaXMuZ2FtZS5hZGQudHdlZW4odGhpcykudG8oe1xuICAgIGFuZ2xlOiAtNDBcbiAgfSwgMTAwKS5zdGFydCgpO1xufTtcblxuQmlyZC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gIGlmICh0aGlzLmFuZ2xlIDwgOTAgJiYgdGhpcy5hbGl2ZSkge1xuICAgIHRoaXMuYW5nbGUgKz0gMi41O1xuICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJpcmQ7IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBHcm91bmQoZ2FtZSwgeCwgeSwgd2lkdGgsIGhlaWdodCkge1xuICBQaGFzZXIuVGlsZVNwcml0ZS5jYWxsKHRoaXMsIGdhbWUsIHgsIHksIHdpZHRoLCBoZWlnaHQsICdncm91bmQnKTtcblxuICB0aGlzLmF1dG9TY3JvbGwoLTIwMCwgMCk7XG5cbiAgZ2FtZS5waHlzaWNzLmFyY2FkZS5lbmFibGVCb2R5KHRoaXMpO1xuICB0aGlzLmJvZHkuYWxsb3dHcmF2aXR5ID0gZmFsc2U7XG4gIHRoaXMuYm9keS5pbW1vdmFibGUgPSB0cnVlO1xufVxuXG5Hcm91bmQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShQaGFzZXIuVGlsZVNwcml0ZS5wcm90b3R5cGUpXG5Hcm91bmQuY29uc3RydWN0b3IgPSBHcm91bmQ7XG5cbm1vZHVsZS5leHBvcnRzID0gR3JvdW5kO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBQaXBlKGdhbWUsIHgsIHksIGZyYW1lKSB7XG4gIFBoYXNlci5TcHJpdGUuY2FsbCh0aGlzLCBnYW1lLCB4LCB5LCAncGlwZScsIGZyYW1lKTtcbiAgdGhpcy5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xuICBnYW1lLnBoeXNpY3MuYXJjYWRlLmVuYWJsZUJvZHkodGhpcyk7XG5cbiAgdGhpcy5ib2R5LmFsbG93R3Jhdml0eSA9IGZhbHNlO1xuICB0aGlzLmJvZHkuaW1tb3ZhYmxlID0gdHJ1ZTtcbn1cblxuUGlwZS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFBoYXNlci5TcHJpdGUucHJvdG90eXBlKTtcblBpcGUuY29uc3RydWN0b3IgPSBQaXBlO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBpcGU7IiwiJ3VzZSBzdHJpY3QnO1xudmFyIFBpcGUgPSByZXF1aXJlKCcuL3BpcGUnKTtcblxuZnVuY3Rpb24gUGlwZUdyb3VwKGdhbWUsIHBhcmVudCkge1xuICBQaGFzZXIuR3JvdXAuY2FsbCh0aGlzLCBnYW1lLCBwYXJlbnQpO1xuXG4gIHRoaXMudG9wUGlwZSA9IG5ldyBQaXBlKGdhbWUsIDAsIDAsIDApO1xuICB0aGlzLmFkZCh0aGlzLnRvcFBpcGUpO1xuXG4gIHRoaXMuYm90dG9tUGlwZSA9IG5ldyBQaXBlKGdhbWUsIDAsIDQ0MCwgMSk7XG4gIHRoaXMuYWRkKHRoaXMuYm90dG9tUGlwZSk7XG5cbiAgdGhpcy5oYXNTY29yZWQgPSBmYWxzZTtcblxuICB0aGlzLnNldEFsbCgnYm9keS52ZWxvY2l0eS54JywgLTIwMCk7XG5cblxufVxuXG5QaXBlR3JvdXAucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShQaGFzZXIuR3JvdXAucHJvdG90eXBlKTtcblBpcGVHcm91cC5jb25zdHJ1Y3RvciA9IFBpcGVHcm91cDtcblxuUGlwZUdyb3VwLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uKHgsIHkpIHtcbiAgdGhpcy50b3BQaXBlLnJlc2V0KDAsIDApO1xuICB0aGlzLmJvdHRvbVBpcGUucmVzZXQoMCwgNDQwKTtcblxuICB0aGlzLnggPSB4O1xuICB0aGlzLnkgPSB5O1xuXG4gIHRoaXMuc2V0QWxsKCdib2R5LnZlbG9jaXR5LngnLCAtMjAwKTtcbiAgdGhpcy5oYXNTY29yZWQgPSBmYWxzZTtcbiAgdGhpcy5leGlzdHMgPSB0cnVlO1xufTtcblxuUGlwZUdyb3VwLnByb3RvdHlwZS5jaGVja1dvcmxkQm91bmRzID0gZnVuY3Rpb24oKSB7XG4gIGlmICghdGhpcy50b3BQaXBlLmluV29ybGQpIHtcbiAgICB0aGlzLmV4aXN0cyA9IGZhbHNlO1xuICB9XG59O1xuXG5QaXBlR3JvdXAucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmNoZWNrV29ybGRCb3VuZHMoKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUGlwZUdyb3VwO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBTY29yZWJvYXJkKGdhbWUpIHtcbiAgICB2YXIgZ2FtZW92ZXI7XG5cbiAgICBQaGFzZXIuR3JvdXAuY2FsbCh0aGlzLCBnYW1lKTtcbiAgICBnYW1lb3ZlciA9IHRoaXMuY3JlYXRlKHRoaXMuZ2FtZS53aWR0aCAvIDIsIDEwMCwgJ2dhbWVvdmVyJyk7XG4gICAgZ2FtZW92ZXIuYW5jaG9yLnNldFRvKDAuNSwgMC41KTtcblxuICAgIHRoaXMuc2NvcmVib2FyZCA9IHRoaXMuY3JlYXRlKHRoaXMuZ2FtZS53aWR0aCAvIDIsIDIwMCwgJ3Njb3JlYm9hcmQnKTtcbiAgICB0aGlzLnNjb3JlYm9hcmQuYW5jaG9yLnNldFRvKDAuNSwgMC41KTtcblxuICAgIHRoaXMuc2NvcmVUZXh0ID0gdGhpcy5nYW1lLmFkZC5iaXRtYXBUZXh0KHRoaXMuc2NvcmVib2FyZC53aWR0aCwgMTgwLCAnZmxhcHB5Zm9udCcsICcnLCAxOCk7XG4gICAgdGhpcy5hZGQodGhpcy5zY29yZVRleHQpO1xuXG4gICAgdGhpcy5iZXN0U2NvcmVUZXh0ID0gdGhpcy5nYW1lLmFkZC5iaXRtYXBUZXh0KHRoaXMuc2NvcmVib2FyZC53aWR0aCwgMjMwLCAnZmxhcHB5Zm9udCcsICcnLCAxOCk7XG4gICAgdGhpcy5hZGQodGhpcy5iZXN0U2NvcmVUZXh0KTtcblxuICAgIC8vIGFkZCBvdXIgc3RhcnQgYnV0dG9uIHdpdGggYSBjYWxsYmFja1xuICAgIHRoaXMuc3RhcnRCdXR0b24gPSB0aGlzLmdhbWUuYWRkLmJ1dHRvbih0aGlzLmdhbWUud2lkdGggLyAyLCAzMDAsICdzdGFydEJ1dHRvbicsIHRoaXMuc3RhcnRDbGljaywgdGhpcyk7XG4gICAgdGhpcy5zdGFydEJ1dHRvbi5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xuXG4gICAgdGhpcy5hZGQodGhpcy5zdGFydEJ1dHRvbik7XG5cbiAgICB0aGlzLnkgPSB0aGlzLmdhbWUuaGVpZ2h0O1xuICAgIHRoaXMueCA9IDA7XG5cbn1cblxuU2NvcmVib2FyZC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFBoYXNlci5Hcm91cC5wcm90b3R5cGUpO1xuU2NvcmVib2FyZC5jb25zdHJ1Y3RvciA9IFNjb3JlYm9hcmQ7XG5cblNjb3JlYm9hcmQucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbihzY29yZSkge1xuICAgIHZhciBtZWRhbCwgYmVzdFNjb3JlO1xuXG4gICAgdGhpcy5zY29yZVRleHQuc2V0VGV4dChzY29yZS50b1N0cmluZygpKTtcblxuICAgIGlmICghIWxvY2FsU3RvcmFnZSkge1xuICAgICAgICAvLyBTdGVwIDJcbiAgICAgICAgYmVzdFNjb3JlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2Jlc3RTY29yZScpO1xuXG4gICAgICAgIC8vIFN0ZXAgM1xuICAgICAgICBpZiAoIWJlc3RTY29yZSB8fCBiZXN0U2NvcmUgPCBzY29yZSkge1xuICAgICAgICAgICAgYmVzdFNjb3JlID0gc2NvcmU7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYmVzdFNjb3JlJywgYmVzdFNjb3JlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gRmFsbGJhY2suIExvY2FsU3RvcmFnZSBpc24ndCBhdmFpbGFibGVcbiAgICAgICAgYmVzdFNjb3JlID0gJ04vQSc7XG4gICAgfVxuXG4gICAgLy8gU3RlcCA0XG4gICAgdGhpcy5iZXN0U2NvcmVUZXh0LnNldFRleHQoYmVzdFNjb3JlLnRvU3RyaW5nKCkpO1xuXG4gICAgLy8gU3RlcCA1ICYgNlxuICAgIGlmIChzY29yZSA+PSAxMCAmJiBzY29yZSA8IDIwKSB7XG4gICAgICAgIG1lZGFsID0gdGhpcy5nYW1lLmFkZC5zcHJpdGUoLTY1LCA3LCAnbWVkYWxzJywgMSk7XG4gICAgICAgIG1lZGFsLmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XG4gICAgICAgIHRoaXMuc2NvcmVib2FyZC5hZGRDaGlsZChtZWRhbCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHNjb3JlID49IDIwKSB7XG4gICAgICAgIG1lZGFsID0gdGhpcy5nYW1lLmFkZC5zcHJpdGUoLTY1LCA3LCAnbWVkYWxzJywgMCk7XG4gICAgICAgIG1lZGFsLmFuY2hvci5zZXRUbygwLjUsIDAuNSk7XG4gICAgICAgIHRoaXMuc2NvcmVib2FyZC5hZGRDaGlsZChtZWRhbCk7XG4gICAgfVxuXG4gICAgLy8gU3RlcCA3XG4gICAgaWYgKG1lZGFsKSB7XG5cbiAgICAgICAgdmFyIGVtaXR0ZXIgPSB0aGlzLmdhbWUuYWRkLmVtaXR0ZXIobWVkYWwueCwgbWVkYWwueSwgNDAwKTtcbiAgICAgICAgdGhpcy5zY29yZWJvYXJkLmFkZENoaWxkKGVtaXR0ZXIpO1xuICAgICAgICBlbWl0dGVyLndpZHRoID0gbWVkYWwud2lkdGg7XG4gICAgICAgIGVtaXR0ZXIuaGVpZ2h0ID0gbWVkYWwuaGVpZ2h0O1xuXG4gICAgICAgIGVtaXR0ZXIubWFrZVBhcnRpY2xlcygncGFydGljbGUnKTtcblxuICAgICAgICBlbWl0dGVyLnNldFJvdGF0aW9uKC0xMDAsIDEwMCk7XG4gICAgICAgIGVtaXR0ZXIuc2V0WFNwZWVkKDAsIDApO1xuICAgICAgICBlbWl0dGVyLnNldFlTcGVlZCgwLCAwKTtcbiAgICAgICAgZW1pdHRlci5taW5QYXJ0aWNsZVNjYWxlID0gMC4yNTtcbiAgICAgICAgZW1pdHRlci5tYXhQYXJ0aWNsZVNjYWxlID0gMC41O1xuICAgICAgICBlbWl0dGVyLnNldEFsbCgnYm9keS5hbGxvd0dyYXZpdHknLCBmYWxzZSk7XG5cbiAgICAgICAgZW1pdHRlci5zdGFydChmYWxzZSwgMTAwMCwgMTAwMCk7XG5cbiAgICB9XG4gICAgdGhpcy5nYW1lLmFkZC50d2Vlbih0aGlzKS50byh7XG4gICAgICAgIHk6IDBcbiAgICB9LCAxMDAwLCBQaGFzZXIuRWFzaW5nLkJvdW5jZS5PdXQsIHRydWUpO1xufTtcblxuU2NvcmVib2FyZC5wcm90b3R5cGUuc3RhcnRDbGljayA9IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdnYW1lJyk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNjb3JlYm9hcmQ7IiwiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBQcmVsb2FkZXIoKSB7XG4gIHRoaXMuYXNzZXQgPSBudWxsO1xuICB0aGlzLnJlYWR5ID0gZmFsc2U7XG59XG5cblByZWxvYWRlci5wcm90b3R5cGUgPSB7XG5cbiAgcHJlbG9hZDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuYXNzZXQgPSB0aGlzLmFkZC5zcHJpdGUodGhpcy53aWR0aC8yLCB0aGlzLmhlaWdodC8yLCAncHJlbG9hZGVyJyk7XG4gICAgdGhpcy5hc3NldC5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xuXG4gICAgdGhpcy5sb2FkLm9uTG9hZENvbXBsZXRlLmFkZE9uY2UodGhpcy5vbkxvYWRDb21wbGV0ZSwgdGhpcyk7XG4gICAgdGhpcy5sb2FkLnNldFByZWxvYWRTcHJpdGUodGhpcy5hc3NldCk7XG4gICAgXG4gICAgdGhpcy5sb2FkSW1hZ2VzKCk7XG4gICAgXG4gICAgdGhpcy5sb2FkLmJpdG1hcEZvbnQoJ2ZsYXBweWZvbnQnLCAnYXNzZXRzL2ZvbnRzL2ZsYXBweWZvbnQvZmxhcHB5Zm9udC5wbmcnLCAnYXNzZXRzL2ZvbnRzL2ZsYXBweWZvbnQvZmxhcHB5Zm9udC5mbnQnKTtcbiAgICBcbiAgICB0aGlzLmxvYWRTcHJpdGVzaGVldHMoKTtcbiAgICBcbiAgICB0aGlzLmxvYWRTb3VuZHMoKTtcbiAgfSxcbiAgXG4gIGxvYWRJbWFnZXM6IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdiYWNrZ3JvdW5kJywgJ2Fzc2V0cy9iYWNrZ3JvdW5kLnBuZycpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnZ3JvdW5kJywgJ2Fzc2V0cy9ncm91bmQucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCd0aXRsZScsICdhc3NldHMvdGl0bGUucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdzdGFydEJ1dHRvbicsICdhc3NldHMvc3RhcnQtYnV0dG9uLnBuZycpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnaW5zdHJ1Y3Rpb25zJywgJ2Fzc2V0cy9pbnN0cnVjdGlvbnMucG5nJyk7XG4gICAgdGhpcy5sb2FkLmltYWdlKCdnZXRSZWFkeScsICdhc3NldHMvZ2V0LXJlYWR5LnBuZycpO1xuICAgIHRoaXMubG9hZC5pbWFnZSgnc2NvcmVib2FyZCcsICdhc3NldHMvc2NvcmVib2FyZC5wbmcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ2dhbWVvdmVyJywgJ2Fzc2V0cy9nYW1lb3Zlci5wbmcnKTtcbiAgICB0aGlzLmxvYWQuaW1hZ2UoJ3BhcnRpY2xlJywgJ2Fzc2V0cy9wYXJ0aWNsZS5wbmcnKTtcbiAgfSxcbiAgbG9hZFNvdW5kczogZnVuY3Rpb24oKXtcbiAgICB0aGlzLmxvYWQuYXVkaW8oJ3Njb3JlJywgJ2Fzc2V0cy9zY29yZS53YXYnKTtcbiAgICB0aGlzLmxvYWQuYXVkaW8oJ2ZsYXAnLCAnYXNzZXRzL2ZsYXAud2F2Jyk7XG4gICAgdGhpcy5sb2FkLmF1ZGlvKCdwaXBlSGl0JywgJ2Fzc2V0cy9waXBlLWhpdC53YXYnKTtcbiAgICB0aGlzLmxvYWQuYXVkaW8oJ2dyb3VuZEhpdCcsICdhc3NldHMvZ3JvdW5kLWhpdC53YXYnKTtcbiAgfSxcbiAgbG9hZFNwcml0ZXNoZWV0czogZnVuY3Rpb24oKXtcbiAgICB0aGlzLmxvYWQuc3ByaXRlc2hlZXQoJ2JpcmQnLCAnYXNzZXRzL2JpcmQucG5nJywgMzQsIDI0LCAzKTtcbiAgICB0aGlzLmxvYWQuc3ByaXRlc2hlZXQoJ3BpcGUnLCAnYXNzZXRzL3BpcGVzLnBuZycsIDU0LCAzMjAsIDIpO1xuICAgIHRoaXMubG9hZC5zcHJpdGVzaGVldCgnbWVkYWxzJywgJ2Fzc2V0cy9tZWRhbHMucG5nJywgNDQsIDQ2LCAyKTtcbiAgfSxcbiAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5hc3NldC5jcm9wRW5hYmxlZCA9IGZhbHNlO1xuICB9LFxuICBcbiAgdXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCEhdGhpcy5yZWFkeSkge1xuICAgICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdnYW1lJyk7XG4gICAgfVxuICB9LFxuXG4gIG9uTG9hZENvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5yZWFkeSA9IHRydWU7XG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUHJlbG9hZGVyOyJdfQ==
